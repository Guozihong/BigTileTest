{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "//累计登陆视图控制器\nvar display = require(\"Display\");\nvar VO = {\n    DragVO : {//扡动事件\n        offset : {x:0, y:0},\n        startPoint : {x:0, y:0},\n        isDrag : false//是否是拖动\n    }\n};\ncc.Class({\n    name:\"WorldMapMediator\",\n    extends: cc.Component,\n    properties: {\n    },\n    onLoad: function () {\n        // this._super()\n        this.cityMap = {}\n    },\n    onExit:function(){\n        cc.log(\"onexit\")\n    },\n    preload:function(cb) {\n         var list = [\n            ['big', cc.TiledMapAsset],\n        ];\n        display.preload(list, function(is, per){\n            if (is) cb();\n        })\n    },\n\n    setNodePosition:function(x, y){\n        this.node.setPosition(x - 480, y - 320)\n    },\n    getNodePosition:function (argument) {\n        var _p = this.node.getPosition()\n        _p.x += 480\n        _p.y += 320\n        return _p\n    },\n    getMapSize:function(){\n        var size = this.node.getComponent(cc.TiledMap).getMapSize()\n        var tieldSize = this.node.getComponent(cc.TiledMap).getTileSize()\n        var mapSize = cc.size(size.width * tieldSize.width, size.height * tieldSize.height)\n        // cc.log(\"getMapSize\", mapSize)\n        return mapSize\n    },\n    start:function(){\n        var self = this\n        // this.cityNode.setPosition(0, 0)\n        this.preload(function(){\n             cc.director.setDisplayStats(true)\n            self.initTouchEvent()\n            var tmxAsset = display.getTmxAsset('big')\n            self.node.getComponent(cc.TiledMap).tmxAsset = tmxAsset\n            //特效层\n            self.showTilesAtDisplayPoint(cc.p(480, 320))\n        })\n    },\n\n    //取得地图处于屏幕正中间的点\n    //地图anchor 0, 0.5\n    getDisplayCenterPoint:function(){\n        var size = this.getMapSize()\n        var anchor = this.node.getAnchorPoint()\n        var point = this.getNodePosition()\n        var scale = this.node.getScale()\n        var p = cc.p((480 - point.x) / scale, (320 - point.y) / scale )\n        p.x = parseInt(p.x)\n        p.y = parseInt(p.y)\n        // cc.log(\"getDisplayCenterPoint\", size, anchor, point, scale, p.x, p.y)\n        return p\n    },\n\n    getMapFullSize:function(){\n        var size = this.node.getComponent(cc.TiledMap).getMapSize()\n        var tieldSize = this.node.getComponent(cc.TiledMap).getTileSize()\n        return cc.size(size.width * tieldSize.width, size.height * tieldSize.height)\n    },\n\n    //处理地图拖动相关\n    initTouchEvent:function(){\n        var self = this\n        // 添加单点触摸事件监听器\n        var listener = {\n            event: cc.EventListener.TOUCH_ONE_BY_ONE,\n            onTouchBegan: function (touches, event) {\n                cc.log('Touch Began: ' , event);\n                self.drag = cc.instantiate(VO.DragVO)\n                var startPoint = cc.instantiate(touches.getLocation())\n                var mapStartPoint = self.node.getPosition()\n                self.drag.startPoint = startPoint\n                self.drag.offset.x = mapStartPoint.x - startPoint.x;\n                self.drag.offset.y = mapStartPoint.y - startPoint.y;\n                return true; //这里必须要写 return true \n            },\n            onTouchMoved: function (touches, event) {\n                // cc.log('Touch Moved: ' + event);\n                var point = touches.getLocation()\n                if (cc.pDistance(point, self.drag.startPoint) > 2) {//是移动\n                    self.drag.isDrag = true\n                    var p = cc.p(point.x + self.drag.offset.x, point.y + self.drag.offset.y)\n                    self.node.setPosition(p)\n                }\n            },\n            onTouchEnded: function (touches, event) {\n               // cc.log('Touch Ended: ' + event);\n                if (self.drag.isDrag) {\n                    self.onPositionChange(touches.getLocation())\n                } else {\n                    \n                }\n            },\n            onTouchCancelled: function (touches, event) {\n               // cc.log('Touch Cancelled: ' + event);\n                if (self.drag.isDrag) {\n                    self.onPositionChange(touches.getLocation())\n                }\n            }\n        }\n        // 绑定单点触摸事件\n        cc.eventManager.addListener(listener, this.node);\n    },\n\n    onPositionChange:function(p){\n         this.showTilesAtDisplayPoint(cc.p(480, 320))\n    },\n\n    //地图中心点0 0.5的坐标取对应点所在xy\n    getTileXYByInMapPosition:function(p){\n        var tieldSize = this.node.getComponent(cc.TiledMap).getTileSize()\n        var mapSize = this.node.getComponent(cc.TiledMap).getMapSize()\n        var TileW = tieldSize.width\n        var TileH = tieldSize.height\n        var N = p.x/TileW - p.y/TileH\n        var M = p.x/TileW + p.y/TileH\n        var x = N\n        var y = mapSize.height - M\n        // cc.log(\"getTileXYByInMapPosition\", p, x, y)\n        x = parseInt(x)\n        y = parseInt(y)\n        return cc.p(x, y)\n    },\n\n    //取得外部某点相对于地图0,0.5的距离\n    getDisplayPointToMapZeroHalf:function(p)\n    {\n        var fullSize = this.getMapFullSize()\n        var anchor = this.node.getAnchorPoint()\n        var mp = this.getNodePosition()\n        var scale = this.node.getScale()\n        var _x = (fullSize.width * anchor.x - mp.x + p.x) / scale;\n        var _y = (fullSize.height * anchor.y - mp.y + p.y - fullSize.height / 2) / scale;\n        var off = cc.p(0, 0)//转换的坐标不知道为什么存在一点稳定的偏移 先添加常规偏移量解决\n        _x += off.x/scale\n        _y += off.y/scale\n        return cc.p(_x, _y)\n    },\n    //根据屏幕坐标显示格子\n    showTilesAtDisplayPoint:function (p) {\n         var mapPosition = this.getDisplayPointToMapZeroHalf(p)\n         var tileP = this.getTileXYByInMapPosition(mapPosition)\n         this.showTilesAtMapPoint(tileP.x, tileP.y)\n    },\n\n    //显示指定xy的格子 即周围正负3的格子\n    //移除超过x y 多少的格子\n    showTilesAtMapPoint:function(x, y){\n        // cc.log(\"showTilesAtMapPoint\", x, y)\n        var layers = this.node.getComponent(cc.TiledMap).allLayers()\n        for (var i in layers) {\n            layers[i].setupTilesBeyondPos(cc.p(x, y), 11)\n        }\n    },\n\n    close:function(){\n    }\n});"
  ]
}